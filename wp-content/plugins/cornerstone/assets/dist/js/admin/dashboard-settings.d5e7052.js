var tco="object"==typeof tco?tco:{};tco.main=function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),r=Object.prototype.hasOwnProperty,o=Array.prototype.splice,a=Object.prototype.toString;function i(e){return a.call(e).slice(8,-1)}var c=Object.assign||function(e,t){return l(t).forEach((function(n){r.call(t,n)&&(e[n]=t[n])})),e},l="function"==typeof Object.getOwnPropertySymbols?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function u(e){return Array.isArray(e)?c(e.constructor(e.length),e):"Map"===i(e)?new Map(e):"Set"===i(e)?new Set(e):e&&"object"==typeof e?c(Object.create(Object.getPrototypeOf(e)),e):e}var p=function(){function e(){this.commands=c({},m),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,t){return e===t},this.update.newContext=function(){return(new e).update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),e.prototype.extend=function(e,t){this.commands[e]=t},e.prototype.update=function(e,t){var n=this,o="function"==typeof t?{$apply:t}:t;Array.isArray(e)&&Array.isArray(o)||s(!Array.isArray(o),"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."),s("object"==typeof o&&null!==o,"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: %s.",Object.keys(this.commands).join(", "));var a=e;return l(o).forEach((function(t){if(r.call(n.commands,t)){var s=e===a;a=n.commands[t](o[t],a,o,e),s&&n.isEquals(a,e)&&(a=e)}else{var c="Map"===i(e)?n.update(e.get(t),o[t]):n.update(e[t],o[t]),l="Map"===i(a)?a.get(t):a[t];n.isEquals(c,l)&&(void 0!==c||r.call(e,t))||(a===e&&(a=u(e)),"Map"===i(a)?a.set(t,c):a[t]=c)}})),a},e}();t.Context=p;var m={$push:function(e,t,n){return h(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return h(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,r){return function(e,t){s(Array.isArray(e),"Expected $splice target to be an array; got %s",e),b(t.$splice)}(t,n),e.forEach((function(e){b(e),t===r&&e.length&&(t=u(r)),o.apply(t,e)})),t},$set:function(e,t,n){return function(e){s(1===Object.keys(e).length,"Cannot have more than one key in an object with $set")}(n),e},$toggle:function(e,t){f(e,"$toggle");var n=e.length?u(t):t;return e.forEach((function(e){n[e]=!t[e]})),n},$unset:function(e,t,n,s){return f(e,"$unset"),e.forEach((function(e){Object.hasOwnProperty.call(t,e)&&(t===s&&(t=u(s)),delete t[e])})),t},$add:function(e,t,n,s){return g(t,"$add"),f(e,"$add"),"Map"===i(t)?e.forEach((function(e){var n=e[0],r=e[1];t===s&&t.get(n)!==r&&(t=u(s)),t.set(n,r)})):e.forEach((function(e){t!==s||t.has(e)||(t=u(s)),t.add(e)})),t},$remove:function(e,t,n,s){return g(t,"$remove"),f(e,"$remove"),e.forEach((function(e){t===s&&t.has(e)&&(t=u(s)),t.delete(e)})),t},$merge:function(e,t,n,r){var o,a;return o=t,s((a=e)&&"object"==typeof a,"update(): $merge expects a spec of type 'object'; got %s",a),s(o&&"object"==typeof o,"update(): $merge expects a target of type 'object'; got %s",o),l(e).forEach((function(n){e[n]!==t[n]&&(t===r&&(t=u(r)),t[n]=e[n])})),t},$apply:function(e,t){var n;return s("function"==typeof(n=e),"update(): expected spec of $apply to be a function; got %s.",n),e(t)}},d=new p;function h(e,t,n){s(Array.isArray(e),"update(): expected target of %s to be an array; got %s.",n,e),f(t[n],n)}function f(e,t){s(Array.isArray(e),"update(): expected spec of %s to be an array; got %s. Did you forget to wrap your parameter in an array?",t,e)}function b(e){s(Array.isArray(e),"update(): expected spec of $splice to be an array of arrays; got %s. Did you forget to wrap your parameters in an array?",e)}function g(e,t){var n=i(e);s("Map"===n||"Set"===n,"update(): %s expects a target of type Set or Map; got %s",t,n)}t.isEquals=d.update.isEquals,t.extend=d.extend,t.default=d.update,t.default.default=e.exports=c(t.default,t)},function(e,t){e.exports=window.tco},function(e,t){!function(){e.exports=this.jQuery}()},function(e,t){!function(){e.exports=this.React}()},function(e,t){!function(){e.exports=this.ReactDOM}()},function(e,t,n){"use strict";e.exports=function(e,t,n,s,r,o,a,i){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,s,r,o,a,i],u=0;(c=new Error(t.replace(/%s/g,(function(){return l[u++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,t,n){"use strict";n.r(t);var s=n(0),r=n(3),o=n.n(r),a=n(2),i=n.n(a),c=n(4),l=n.n(c),u=n(5),p=n.n(u),m=n(1),d=n.n(m);const h=["content"],f={element:"{id}",content:"{post-type}",preference:"{id}"};class b extends l.a.Component{constructor(e){super(e);let{roles:t,defaults:n,permissions:s}=e,r={};t.forEach(({value:e})=>r[e]=Object.assign({},n._default,n[e]?n[e]:{})),this.state={nowConfiguring:null,activeRole:t[0].value,defaults:r,permissions:s},window.getPermission=e=>this.getPermission(e),window.currentPermissions=()=>this.state.permissions}serializePermissions(){let e={};return Object.keys(this.state.permissions).forEach(t=>{e[t]={},Object.keys(this.state.permissions[t]).forEach(n=>{n.includes("{")||(e[t][n]=this.state.permissions[t][n])})}),JSON.stringify(e)}setActiveRole(e){this.setState(d()(this.state,{activeRole:{$set:e}}))}setConfigureKey(e){let t=e===this.state.nowConfiguring?null:e;this.setState(d()(this.state,{nowConfiguring:{$set:t}}))}renderNavItem({value:e,label:t}){let n=[e];return e===this.state.activeRole&&n.push("tco-active"),Object(s.createElement)("li",{key:e,className:n.join(" "),onClick:()=>this.setActiveRole(e),dangerouslySetInnerHTML:{__html:t}})}toggleAccess(e){this.updateAccess(e,!this.getPermission(e))}updateAccess(e,t){let n=e.split("."),s=Object.keys(f).includes(n[0]);n.length<=2&&h.includes(n[0])&&(s=!1),this.state.defaults[this.state.activeRole][e]&&(s=!0),s?!1===t?this.updatePermission(e,!1):this.unsetPermission(e):t?this.updatePermission(e,!0):this.unsetPermission(e)}resetRole(e){clearTimeout(this.stateSetTimer),this.nextState||(this.nextState=this.state),this.nextState=d()(this.nextState,{permissions:{$unset:[e]}}),this.stateSetTimer=setTimeout(()=>this.commitState(),0)}unsetPermission(e){clearTimeout(this.stateSetTimer),this.nextState||(this.nextState=this.state),this.nextState=d()(this.nextState,{permissions:{[this.nextState.activeRole]:t=>d()(t||{},{$unset:[e]})}}),this.stateSetTimer=setTimeout(()=>this.commitState(),0)}updatePermission(e,t){clearTimeout(this.stateSetTimer),this.nextState||(this.nextState=this.state),this.nextState=d()(this.nextState,{permissions:{[this.nextState.activeRole]:n=>d()(n||{},{[e]:{$set:t}})}}),this.stateSetTimer=setTimeout(()=>this.commitState(),0)}commitState(){this.nextState&&(this.setState(this.nextState),this.nextState=null)}getPermission(e){let t=e=>{let t=(this.state.permissions[this.state.activeRole]||{})[e];return void 0===t&&(t=(this.state.defaults[this.state.activeRole]||{})[e]),t},n=t(e),s=e.split(".");return void 0===n&&f[s[0]]&&(n=t([s[0],f[s[0]],...s.splice(2)].join("."))),Object.keys(f).includes(e.split(".")[0])?!1!==n:!!n}updatePreference(e,t){if("off"===t)return this.updateAccess(e,!1);this.updateAccess(e,!0),this.updateAccess(e+".user","user"===t)}renderPreferenceGroup({id:e,title:t,description:n}){let r="preference."+e,o=`${this.state.activeRole}-${e}`,a=this.getPermission(r),i=a?"on":"off";return a&&this.getPermission(r+".user")&&(i="user"),Object(s.createElement)("div",{key:o,className:"tco-form-setting"},Object(s.createElement)("div",{className:"tco-form-setting-info"},Object(s.createElement)("label",{htmlFor:o},Object(s.createElement)("strong",null,t),Object(s.createElement)("span",null,n))),Object(s.createElement)("div",{className:"tco-form-setting-control"},Object(s.createElement)("select",{onChange:({target:e})=>this.updatePreference(r,e.value),id:o,value:i,className:"tco-form-control tco-form-control-max"},Object(s.createElement)("option",{value:"user"},this.props.i18n["preference-user"]),Object(s.createElement)("option",{value:"on"},this.props.i18n["preference-on"]),Object(s.createElement)("option",{value:"off"},this.props.i18n["preference-off"]))))}renderElementGroup({id:e,title:t,options:n}){return this.renderSettingsGroup({id:"element."+e,title:t,options:n})}renderSettingsGroup({id:e,title:t,options:n}){let r=`${this.state.activeRole}-${e}`;return Object(s.createElement)(j,{key:r,group:r,id:e,title:t,options:n,active:this.getPermission(e),open:r===this.state.nowConfiguring,onToggleOpen:()=>this.setConfigureKey(r),onToggleActive:e=>this.toggleAccess(e),getPermission:e=>this.getPermission(e),onToggleItem:(e,t)=>this.updateAccess(e,t),i18n:this.props.i18n})}renderMacros(){const e=e=>{e.preventDefault();let t=document.querySelector('select[name="tco-permissions-macros"]').value;t&&i.a.confirm({message:this.props.i18n["macros-warning"],acceptClass:"tco-btn-nope",acceptBtn:this.props.i18n["macros-continue"],declineBtn:this.props.i18n["macros-go-back"],accept:()=>this.applyMacro(t)})};return Object(s.createElement)("div",{className:"tco-form-setting tco-form-setting-permissions-macros"},Object(s.createElement)("div",{className:"tco-form-setting-info"},Object(s.createElement)("label",{htmlFor:"tco-permissions-macros"},Object(s.createElement)("strong",null,this.props.i18n["macros-label"]),Object(s.createElement)("span",null,this.props.i18n["macros-desc"]))),Object(s.createElement)("div",{className:"tco-form-setting-control"},Object(s.createElement)("div",{className:"tco-form-setting-control-with-action tco-form-control-max"},Object(s.createElement)("select",{name:"tco-permissions-macros",className:"tco-form-control tco-form-control-max"},Object.keys(this.props.macros).map(e=>Object(s.createElement)("option",{key:"macro-"+e,value:e},"i18n"===this.props.macros[e].label?this.props.i18n["macro-"+e]:this.props.macros[e].label))),Object(s.createElement)("button",{className:"tco-form-control-action",onClick:t=>e(t)},this.props.i18n["macros-apply"]))))}applyMacro(e){let{command:t,actions:n={}}=this.props.macros[e]||{};const s={reset:()=>{this.resetRole(this.state.activeRole)}};return Object.keys(n).forEach(e=>this.updateAccess(e,n[e])),t&&s[t]&&s[t]()}render(){let{roles:e,controls:t,i18n:n}=this.props,r={classic:[],v2:[]};return t.elements.forEach(e=>r[e.classic?"classic":"v2"].push(e)),Object(s.createElement)("div",{className:"tco-box tco-box-permissions"},Object(s.createElement)("input",{readOnly:!0,type:"text",style:{display:"none"},value:this.serializePermissions(),"data-cs-control":!0,name:"permissions"}),Object(s.createElement)("header",{className:"tco-box-header"},Object(s.createElement)("h2",{className:"tco-box-title"},n.title)),Object(s.createElement)("div",{className:"tco-box-content tco-pan"},Object(s.createElement)("div",{className:"tco-box-permissions-roles"},Object(s.createElement)("ul",null,e.map(e=>this.renderNavItem(e)))),Object(s.createElement)("div",{className:"tco-box-permissions-settings"},Object(s.createElement)(v,{title:n.macros,startOpen:!0,renderContent:()=>this.renderMacros()}),Object(s.createElement)(v,{title:n.general,startOpen:!0,renderContent:()=>t.general.map(e=>this.renderSettingsGroup(e))}),Object(s.createElement)(v,{title:n["v2-elements"],renderContent:()=>r.v2.map(e=>this.renderElementGroup(e))}),Object(s.createElement)(v,{title:n["classic-elements"],renderContent:()=>r.classic.map(e=>this.renderElementGroup(e))}),Object(s.createElement)(v,{title:n.preferences,renderContent:()=>t.preferences.map(e=>this.renderPreferenceGroup(e))}))))}}const g=({id:e,label:t,checked:n,onChange:r})=>Object(s.createElement)("label",{className:"tco-rc tco-checkbox",htmlFor:e},Object(s.createElement)("input",{id:e,name:e,checked:!!n,onChange:({target:e})=>r(e.checked),className:"tco-form-control tco-form-control-max",type:"checkbox"}),Object(s.createElement)("span",{className:"tco-form-control-indicator"}),Object(s.createElement)("span",{className:"tco-form-control-indicator-label"},t));class v extends l.a.Component{constructor(e){super(e),this.state={isActive:e.startOpen}}toggleOpen(e){e.preventDefault(),this.setState(d()(this.state,{isActive:{$set:!this.state.isActive}}))}getActiveClass(){return"tco-box-permissions-settings-section "+(this.state.isActive?"cs-active":"")}render(){return Object(s.createElement)("section",{className:this.getActiveClass()},Object(s.createElement)("h3",{className:"tco-box-permissions-settings-title"},Object(s.createElement)("button",{onClick:e=>this.toggleOpen(e)},Object(s.createElement)("span",{dangerouslySetInnerHTML:{__html:this.props.title}}))),this.state.isActive&&Object(s.createElement)("ul",{className:"tco-box-permissions-settings-groups"},this.props.renderContent()))}}const y=()=>Object(s.createElement)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 24 24",xmlSpace:"preserve",width:"24",height:"24"},Object(s.createElement)("path",{fill:"none",strokeWidth:"2",strokeLinecap:"square",strokeMiterlimit:"10",d:"M17,4.3c3,1.7,5,5,5,8.7 c0,5.5-4.5,10-10,10S2,18.5,2,13c0-3.7,2-6.9,5-8.7",strokeLinejoin:"miter"}),Object(s.createElement)("line",{fill:"none",strokeWidth:"2",strokeLinecap:"square",strokeMiterlimit:"10",x1:"12",y1:"1",x2:"12",y2:"8",strokeLinejoin:"miter"})),j=({group:e,active:t,open:n,id:r,title:o,options:a,onToggleActive:i,i18n:c,getPermission:l,onToggleItem:u,onToggleOpen:p})=>{const m=({name:t,optionId:n,label:r,checked:o})=>{let a=`tco-permission-${e}-${t}`;return Object(s.createElement)("li",{key:a},Object(s.createElement)(g,{id:a,checked:o,label:r,onChange:e=>u(n,e)}))};return Object(s.createElement)("li",{key:r,className:"tco-box-permissions-settings-group"},Object(s.createElement)("h4",{className:"tco-box-permissions-settings-group-title"},Object(s.createElement)("button",{className:""+(t?"cs-active":""),onClick:e=>(e=>{e.preventDefault(),i(r)})(e)},Object(s.createElement)("span",null,Object(s.createElement)(y,null),Object(s.createElement)("strong",{dangerouslySetInnerHTML:{__html:o}}))),t&&Object(s.createElement)("button",{onClick:e=>(e=>{e.preventDefault(),p()})(e)},t?n?c.close:c.config:"")),t&&(()=>{if(n){const t=a.map(e=>{let t=`${r}.${e}`;return{optionId:t,checked:l(t),label:c[e.replace(/_/g,"-")],name:e}});let n=t.map(m),o=e+"-toggle-all";return n.push(Object(s.createElement)("li",{key:o},Object(s.createElement)(g,{id:o,checked:t.filter(({checked:e})=>e).length===t.length,label:c["toggle-all"],onChange:e=>t.forEach(({optionId:t})=>u(t,e))}))),Object(s.createElement)("ul",{className:"tco-box-permissions-settings-group-controls-list"},n)}})())};var O=b;i.a.addDataSource(window.csDashboardSettingsData),i.a.addModule("cs-settings",(function(e,t,n){var s=t.form||!1,r=t.update||!1;s&&r&&r.on("click",(function(t){t.preventDefault(),r.html(n.updating),r.prop("disabled",!0);var s=function(){var t={};return e.find("[data-cs-control]").each((function(){var e=o()(this),n=e.data("cs-control"),s=e.val();"checkbox"===n&&(s=e.prop("checked")),t[e.attr("name")]=s})),t}();i.a.ajax({action:"cs_dashboard_save_settings",data:s,_cs_nonce:window.csDashboardSettingsData._cs_nonce,done:function(){r.html(n.updated),r.addClass("tco-btn-yep");var e=s.custom_app_slug.match(/^[-\w]+$/);if(e){var t=window.csDashboardSettingsData.homeURL+"/"+e[0];o()("#wp-admin-bar-cs-launch a").attr("href",t),o()("span.tco-menu-launch").parent().attr("href",t)}setTimeout((function(){r.html(n.update),r.removeClass("tco-btn-yep"),r.prop("disabled",!1)}),3500)},fail:function(e){r.html(n.error),r.removeClass("tco-btn-yep"),r.addClass("tco-btn-nope"),console.warn("Cornerstone Save Settings Error",e)}})}))})),i.a.addModule("cs-role-manager",(e,t,n)=>{p.a.render(Object(s.createElement)(O,n),e[0])})}]);