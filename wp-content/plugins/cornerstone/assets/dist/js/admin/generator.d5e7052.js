var tco="object"==typeof tco?tco:{};tco.main=function(e){var t={};function o(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t){!function(){e.exports=this.jQuery}()},function(e,t,o){"use strict";o.r(t);var a=o(0),n=o.n(a);window.csg=window.csg||{};const{csg:s}=window,{_:l}=window,{Backbone:i}=window;s.Templates={"blank-state":'<div class="csg-intro"><p><% print(csg.l18n("blank-window")); %></p></div>',modal:'<div class="csg-modal"><header><h1><%= csg.l18n("modal-title") %></h1><a class="csg-modal-btn csg-modal-toggle-advanced" href="#"><span class="dashicons dashicons-media-code"></span><span class="tip"><%= csg.l18n("modal-toggle-advanced") %></span></a><a class="csg-modal-btn csg-modal-close" href="#"><span class="dashicons dashicons-no"></span></a></header><div class="csg-modal-content"><section class="csg-modal-sidebar"></section><section class="csg-modal-main" role="main"></section></div><footer><button id="btn-ok" disabled class="button button-primary button-large"><%= csg.l18n("modal-insert-shortcode") %></button></footer></div><div class="csg-modal-backdrop">&nbsp;</div>',preview:'<h2 class="csg-preview-title"><% print(csg.l18n("preview-title")); %></h2><div class="csg-preview-content"><p><% print(csgData.previewContentBefore) %></p><p><a class="button" href="<%= demo %>" target="_blank"><% print(csg.l18n("preview-button")); %></a></p><p><% print(csgData.previewContentAfter) %></p></div>',"controls/checkbox":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><input type="checkbox" id="param-<%= param_name %>" name="param-<%= param_name %>" value="<%= value %>" />',"controls/color-picker":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><input type="text" name="param-<%= param_name %>" id="param-<%= param_name %>" class="wp-color-picker" value="" size="30" />',"controls/dropdown":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><select name="param-<%= param_name %>" id="param-<%= param_name %>"><% _.each(value, function(option, name) { %><option value="<% print( option.value || option ) %>"><% print( (option.value) ? name : option) %> </option><% }); %></select>',"controls/image-upload":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><div class="csg-image-uploader"><a href="#" class="csg-img-control set"><span class="dashicons dashicons-plus"></span></a><a href="#" class="csg-img-control remove hidden"><span class="dashicons dashicons-no"></span></a></div><input type="hidden" name="param-<%= param_name %>" id="param-<%= param_name %>" />',"controls/text-area":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><textarea name="param-<%= param_name %>" id="param-<%= param_name %>" rows="8" cols="5"></textarea>',"controls/text":'<label for="param-<%= param_name %>"><strong><%= heading %></strong><span><%= description %></span></label><input type="text" name="param-<%= param_name %>" id="param-<%= param_name %>" value="<%= value %>" size="30" />'},s.template=function(){return l.template(this.Templates[1===arguments.length?arguments[0]:arguments.join("/")])},s.l18n=function(e){return window.csgData.strings[e]||""};const r={},c={};r.Control=i.Model.extend({defaults:{param_name:"generic-param",heading:"Generic Control",description:"",type:"Generic",default_value:"",value:null}}),r.Shortcode=i.Model.extend({defaults:{id:"generic-shortcode",title:"Generic Shortcode",icon:"icon",section:"Generic",description:"A Shortcode Description",params:[],demo:""},setSelected(){this.collection.setSelected(this)}}),r.ShortcodeCollection=i.Collection.extend({model:r.Shortcode,url:window.csgData.shortcodeCollectionUrl,selected:null,section(e){return new r.ShortcodeCollection(this.filter(t=>t.get("section")===e))},setSelected(e){this.selected=e,this.trigger("new_selection")}}),r.ControlCollection=i.Collection.extend({model:r.Control}),c.ControlBase=i.View.extend({className:"csg-control",template:s.template("controls/text"),renderSuper(){return!0===this.model.get("advanced")&&this.$el.addClass("advanced"),this.$el.html(this.template(this.model.toJSON())),this},render(){return this.renderSuper(),this.bindInput(),this},bindInput(){const{model:e}=this;e.set("data",this.$("#param-"+e.get("param_name")).val()),this.$("#param-"+e.get("param_name")).on("change",(function(){e.set("data",n()(this).val())}))}},{makeControl(e,t){const o={base:c.ControlBase,textfield:c.ControlText,textarea:c.ControlTextArea,textarea_html:c.ControlTextArea,dropdown:c.ControlDropdown,checkbox:c.ControlCheckbox,colorpicker:c.ControlColorPicker,attach_image:c.ControlImageUpload};return new(o[e]?o[e]:o.base)(t)}}),c.ControlCheckbox=c.ControlBase.extend({template:s.template("controls/checkbox"),bindInput(){const{model:e}=this;this.$("#param-"+e.get("param_name")).prop("checked")&&e.set("data",this.$("#param-"+e.get("param_name")).val()),this.$("#param-"+e.get("param_name")).on("change",(function(){n()(this).prop("checked")?e.set("data",n()(this).val()):e.unset("data")}))}}),c.ControlColorPicker=c.ControlBase.extend({template:s.template("controls/color-picker"),render(){return this.renderSuper(),this.$(".wp-color-picker").wpColorPicker({change:this.colorChange.bind(this)}),this},colorChange(e,t){this.model.set("data",t.color.toString())},bindInput(){}}),c.ControlDropdown=c.ControlBase.extend({template:s.template("controls/dropdown"),initialize(){this.model.set("selected",this.model.get("default_value")||l(this.model.get("value")).find(()=>!0))}}),c.ControlImageUpload=c.ControlBase.extend({initialize(){c.ControlImageUpload.createMediaFrame()},events:{"click a.csg-img-control.set":"setImage","click a.csg-img-control.remove":"removeImage"},template:s.template("controls/image-upload"),setImage(e){e&&e.preventDefault();const{uploader:t}=c.ControlImageUpload;t.off("insert"),t.on("insert",()=>{const e=t.state().get("selection").first().toJSON();this.$("a.csg-img-control.set").addClass("hidden"),this.$("a.csg-img-control.remove").removeClass("hidden"),this.$(".csg-image-uploader").css({"background-image":`url(${e.url})`}),this.$("input").val(e.url).change()}),t.open()},removeImage(e){e&&e.preventDefault(),this.$("a.csg-img-control.set").removeClass("hidden"),this.$("a.csg-img-control.remove").addClass("hidden"),this.$(".csg-image-uploader").css({"background-image":"none"}),this.$("input").val("")}},{uploader:null,createMediaFrame(){null===this.uploader&&(this.uploader=window.wp.media({frame:"post",state:"insert",multiple:!1}))}}),c.ControlTextArea=c.ControlBase.extend({template:s.template("controls/text-area")}),c.ControlText=c.ControlBase.extend({}),c.ControlGroup=i.View.extend({className:"csg-modal-controls",render(){return this.collection.each((function(e){this.$el.append(c.ControlBase.makeControl(e.get("type"),{model:e}).render().$el)}),this),this}}),c.NavItem=i.View.extend({tagName:"li",events:{click:"click"},className:"csg-nav-item",render(){return this.$el.html(n()(`<a href="#">${this.model.get("title")}</a>`)),this},click(){this.model.setSelected()}}),c.NavSection=i.View.extend({className:"csg-nav-section",render(){return this.$el.append(n()("<ul></ul>")),this.collection.each((function(e){this.$("ul").append(new c.NavItem({model:e}).render().$el)}),this),this}}),c.Nav=i.View.extend({className:"csg-navigation",events:{"click li.csg-nav-item a":"click"},render(){return l(window.csgData.sectionNames).each(e=>{this.$el.append(`<h3>${e}</h3>`),this.$el.append(new c.NavSection({collection:this.collection.section(e)}).render().$el)}),this.$el.accordion({heightStyle:"content"}),this},click(e){this.$("li.csg-nav-item a").removeClass("active"),this.$(e.target).addClass("active")}}),c.Preview=i.View.extend({className:"csg-preview",template:s.template("preview"),render(){return this.$el.html(this.template(l.extend(this.model.toJSON(),this.data))),this}}),c.Window=i.View.extend({className:"csg-modal-window",template:s.template("blank-state"),initialize(e){this.shortcode=e.shortcode},render(){return null===this.shortcode?(this.$el.html(this.template()),this):(this.$el.append(new c.ControlGroup({collection:this.collection}).render().$el),this.$el.append(new c.Preview({model:this.shortcode}).render().$el),this)}}),c.Modal=i.View.extend({id:"csgModal",className:"csg",template:s.template("modal"),events:{"click .csg-modal-close":"close","click .csg-modal-toggle-advanced":"toggleAdvanced","click #btn-ok":"insertShortcode"},controls:null,initialize(e){this.controller=e.controller,this.listenTo(this.collection,"change:completed",this.render),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"new_selection",this.setupControls),this.on("controls_ready",this.renderWindow),this.collection.fetch({reset:!0}),this.render()},render(){this.$el.html(this.template()),this.$(".csg-modal-sidebar").append(new c.Nav({collection:this.collection}).render().$el),this.renderWindow(),this.getAdvancedState()&&this.setAdvancedState(!0),n()("body").append(this.$el).css({overflow:"hidden"}),this.$el.focus(),n()(document).on("focusin",e=>{this.$el[0]===e.target||this.$el.has(e.target).length||this.$el.focus()})},setupControls(){this.controls=new r.ControlCollection(this.collection.selected.get("params")),this.trigger("controls_ready")},renderWindow(){null!==this.collection.selected&&this.$("#btn-ok").prop("disabled",!1),this.$(".csg-modal-main").html(new c.Window({collection:this.controls,shortcode:this.collection.selected}).render().$el)},close(e){e&&e.preventDefault(),this.collection.selected=null,this.undelegateEvents(),n()(document).off("focusin",this.preserveFocus),n()("body").css({overflow:"auto"}),this.remove(),this.controller.deleteModal()},toggleAdvanced(e){e&&e.preventDefault(),this.setAdvancedState(!this.getAdvancedState())},getAdvancedState(){return"undefined"!=typeof Storage?(void 0===window.localStorage["csg-advanced-mode"]&&(window.localStorage["csg-advanced-mode"]=!1),"true"===window.localStorage["csg-advanced-mode"]):this.$el.hasClass("csg-advanced-enabled")},setAdvancedState(e){this.$(".csg-modal-toggle-advanced").removeClass("active"),this.$el.removeClass("csg-advanced-enabled"),e&&(this.$(".csg-modal-toggle-advanced").addClass("active"),this.$el.addClass("csg-advanced-enabled")),window.localStorage["csg-advanced-mode"]=e},insertShortcode(){const e={};let t="",o=this.collection.selected.get("container")||!1;this.controls.each(a=>{const n=a.get("data"),s=a.get("param_name");if("content"===s&&(o=!0),void 0!==n&&""!==n){if("content"===s)return void(t=n);e[s]=n}});const a=this.collection.selected.get("id");let n="["+a;l(e).each((e,t)=>{n+=` ${t}="${e}"`}),n+="]",t&&(n+=t),o&&(n+=`[/${a}]`),window.wp.media.editor.insert(n),this.close()}});const d=function(){n()(window).on("load",()=>{this.shortcodes=new r.ShortcodeCollection,this.shortcodes.fetch({reset:!0})}),n()(document).on("click","#cs-insert-shortcode-button",e=>{e.preventDefault(),this.openModal()})};d.prototype.openModal=function(){void 0===this.modalView&&(this.modalView=new c.Modal({collection:this.shortcodes,controller:this}))},d.prototype.deleteModal=function(){this.modalView=void 0},new d}]);